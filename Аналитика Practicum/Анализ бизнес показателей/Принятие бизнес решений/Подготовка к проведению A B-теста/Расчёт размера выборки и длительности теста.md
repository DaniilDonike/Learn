При А/B-тестировании аналитик учитывает обстоятельства получения выборки:

а) Как долго проходил тест. Принимая решение о длительности теста, учитывают циклические изменения трафика (ежедневные, еженедельные, ежемесячные) и время, за которое покупатель принимает решение о покупке.

б) характерна ли для него **проблема подглядывания** (англ. _peeking problem_), когда в начале теста поступление новых данных значительно искажает общий результат. Каждый, даже небольшой фрагмент новых данных велик относительно уже накопленных — статистическая значимость достигается за короткий срок.

Это одно из проявлений закона больших чисел. Если наблюдений мало, их разброс больше. Если их много, случайные выбросы успели друг друга компенсировать. Значит, если выборка слишком мала, различия увидеть легко. Для статистического теста это снижение _p-value_ до значений, достаточно маленьких, чтобы отвергнуть нулевую гипотезу об отсутствии различий.

![image](https://pictures.s3.yandex.net/resources/stat_znachimost-831f2848-a47f-4de0-bc9c-3c282d24e9bc_1569202218.jpg)

На графике разница конверсии между сегментами, полученная в результате смоделированного A/B-теста. Данные собирали из одной генеральной совокупности и различий в выборочных средних быть не должно.

Тем не менее, из-за флуктуаций в первые дни тестирования была достигнута статистическая значимость. Если бы это был реальный, а не смоделированный тест, и решение приняли бы только по достижении статистической значимости, оно было бы неверным.

Чтобы исправить проблему подглядывания, размер выборки определяют до начала теста.

Вот правильная процедура A/B тестирования:

![image](https://pictures.s3.yandex.net/resources/collect_X-81448fe9-b27d-46f7-b1af-a4b5c9e83fd6_1569202210.jpg)

А вот так делать A/B тестирование не стоит:

![image](https://pictures.s3.yandex.net/resources/collect_X-d138c612-7076-4f10-a122-0f2b80a730b0.1_1569202214.jpg)

### Калькуляторы длительности теста и расчёта размера выборки

Простой способ найти размер выборки — рассчитать в онлайн-калькуляторе.

Примеры калькуляторов:

- [http://www.evanmiller.org/ab-testing/sample-size.html](http://www.evanmiller.org/ab-testing/sample-size.html)
- [https://www.optimizely.com/sample-size-calculator/?conversion=20&effect=5&significance=95](https://www.optimizely.com/sample-size-calculator/?conversion=20&effect=5&significance=95)
- [https://vwo.com/tools/ab-test-duration-calculator/](https://vwo.com/tools/ab-test-duration-calculator/)

Эти сервисы хороши для оценки минимально необходимого объёма выборки, на которой будет заметно изменение показателя, если оно есть. Так можно оценить минимальную длительность теста.

Например, вы тестируете форму оформления заказа: 4 поля против 5. Вы готовы пожертвовать частью собираемых о пользователе данных ради увеличения конверсии. Текущий уровень конверсии равен 1%. Минимальный эффект, который вы хотите обнаружить, равен 5% относительного изменения конверсии: 1.05% против 1% конверсии. Калькулятор скажет, что вам нужно около 900 000 наблюдений в каждой группе. Зная, что весь трафик на проверяемой странице равен 100 000 визитов в день, вы легко найдёте число дней проведения теста. Минимум 18 дней =`900 000 * 2 / 100 000`.