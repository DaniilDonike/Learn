[[Агрегация данных и создание таблиц в БД]]
[[Дата-пайплайны для автоматизации дашбордов]]

При проектировании таблицы агрегированных данных важно помнить, что она должна быть как можно более вертикальной. Добиться этого можно, если следовать правилу: каждому признаку отводить отдельный столбец. Такой метод размещения данных намного лучше автоматизируется и масштабируется.

Например, у вас есть данные о сумме покупок пользователей по месяцам. Можно задать таблицу двумя методами:

- «Вертикальный»: колонка для месяцев, колонка для id пользователей, колонка для сумм их покупок:

|Месяц|id пользователя|Сумма покупок|
|---|---|---|
|Январь 2019|Вася|100|
|Март 2019|Вася|200|
|Апрель 2019|Вася|30|
|Январь 2019|Оля|10|
|Апрель 2019|Оля|500|
|Январь 2019|Света|14|

- «Горизонтальный»: один столбец для id пользователей, для каждого месяца по колонке, на их пересечении — сумма покупок. Иначе говоря, это вариант первой таблицы, к которой применили `pivot_table()` и сгруппировали её данные по id пользователя:
    
|Name|Январь 2019|Март 2019|Апрель 2019|
|---|---|---|---|
|Вася|100|200|30|
|Оля|10||500|
|Света|14||

С «горизонтальной» таблицей возникнет проблема: при добавлении каждой новой колонки в пайплайне, а также в зависящих от него дашбордах и отчётах, придётся заново определять тип столбца и правила обработки пропусков. Эту задачу, конечно, можно решить в коде. Однако гораздо проще строить первый вариант таблицы — в нём добавление новых данных не приведёт к переопределению их структуры.