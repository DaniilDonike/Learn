Одну гипотезу нередко тестируют в разных вариациях. Например, когда нужно сравнить три версии баннера на лендинге или пять вариантов ценообразования.

Сравнивать несколько групп с контрольной можно. Однако учитывайте увеличение вероятности ошибок, роды которых вы изучили в прошлом уроке.

Несколько сравнений, проводимых на одних и тех же данных — это **множественный тест**. Его важная особенность в том, что с каждой новой проверкой гипотезы растёт вероятность ошибки первого рода.

Если всякий раз вероятность ошибиться равна `ɑ`, то вероятность не ошибиться: `1-ɑ`. Так, вероятность не ошибиться ни разу за `k` сравнений равна:

![image](https://pictures.s3.yandex.net/resources/Screenshot_2019-09-23_at_07.22.46_1569212604.png)

В итоге вероятность ошибиться хотя бы раз за `k` сравнений:

![image](https://pictures.s3.yandex.net/resources/Screenshot_2019-09-23_at_07.23.56_1569212649.png)

Например, вы проверяете гипотезу о трёх возможных цветах кнопки «Купить». Против стандартного красного (группа A) потенциальными цветами выступают жёлтый, зеленый и белый (группы B1, B2, B3). Вы выбрали уровень значимости, равный 0.05.

При попарном сравнении вероятность, что тест покажет ложнопозитивный результат равна уровню значимости.

Тогда вероятность того, что хотя бы в одном из трёх попарных сравнений будет зафиксирован ложнопозитивный результат равна:

![image](https://pictures.s3.yandex.net/resources/Screenshot_2019-09-23_at_07.24.56_1569212711.png)

В случае четырёх групп вероятность хотя бы одного ложнопозитивного результата уже примерно 18.55%. Если групп 10 — около 40%. Впрочем, в целях AB-тестирования такое количество групп применяют редко.

Это **групповая вероятность ошибки первого рода**, или **FWER** (от англ. _family-wise error rate,_ «групповой коэффициент ошибок»).

**`FWER = P(V≥1)`**,

где `V` — число отвергнутых нулевых гипотез из числа верных нулевых гипотез. То есть `V` — число ложнопозитивных результатов, а FWER — вероятность получить хотя бы один такой результат. При общем числе гипотез `m = 1`, `FWER = ɑ`.

Чтобы снизить вероятность ложнопозитивного результата при множественном тестировании гипотез, применяют разные методы корректировки уровня значимости для уменьшения FWER.

- **Метод Бонферрони (поправка Бонферрони)**:

Самая грубая и распространённая поправка к требуемым уровням значимости. Уровни значимости в каждом из _m_ сравнений в _m_ раз меньше, чем уровень значимости, требуемый при единственном сравнении. Проще говоря, делят уровень значимости `ɑ` на число гипотез:

![image](https://pictures.s3.yandex.net/resources/Untitled-f33fc295-f007-4b31-b2dd-89ee237989d1_1569201056.png)

- **Метод Холма**

Метод Холма также гарантирует FWER < `ɑ`, но предъявляет более мягкие требования к уровню значимости. Метод пошаговый: для первого сравнения требуемый уровень значимости равен отношению `ɑ` к числу попарных сравнений, для второго — отношению `ɑ` к (числу сравнений - 1) и так далее. Для последнего сравнения уровень значимости будет равен `ɑ`:

![image](https://pictures.s3.yandex.net/resources/Untitled-7e34c02f-158a-41ce-9d25-8e401fa51e42_1569201047.png)

- **Метод Шидака**

Метод Шидака также обеспечивает FWER < `ɑ`. Скорректированное значение требуемого уровня значимости рассчитывается по формуле:

![image](https://pictures.s3.yandex.net/resources/Untitled-0205af56-3059-4316-bc6b-b2eab211a003_1569201052.png)

Например, при `ɑ = 0.05` и при двух сравнениях требуемый уровень значимости рассчитывают так: `1 - (1 - 0.05)^(1/2) = 0.0253`, а при 4 сравнениях: `1 - (1 - 0.05)^(1/4) = 0.0127`.

Чаще всего применяют поправку Бонферрони — из-за простоты решения. Легко поделить принятый уровень значимости на число сравнений, которые проводят на одних и тех же данных, без сбора новых наблюдений для каждого теста. Если вы собираете для каждой проверки гипотезы новые данные, проводите тест как обычно, выбрав нужное значение _p-value_, как это делали в курсе статистики.

При этом, чем более вы требовательны к уровню значимости, тем ниже мощность вашего теста и тем больше различий между группами вы не сможете обнаруживать. Поэтому, если нужно повысить мощность теста, сохраняя FWER < `ɑ`, лучше применяйте методы Холма и Шидака.